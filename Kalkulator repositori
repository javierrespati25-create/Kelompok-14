#include <stdio.h>
#include <stdlib.h>

int main(void) {
    int n, i;
    double voltage;
    double totalR = 0.0;

    printf("KALKULATOR RESISTOR SERI\n");
    printf("-------------------------\n");

    printf("Masukkan jumlah resistor: ");
    if (scanf("%d", &n) != 1 || n <= 0) {
        fprintf(stderr, "Input tidak valid. Jumlah resistor harus bilangan bulat > 0.\n");
        return 1;
    }

    double *R = (double *) malloc(n * sizeof(double));
    if (R == NULL) {
        fprintf(stderr, "Gagal alokasikan memori.\n");
        return 1;
    }

    for (i = 0; i < n; ++i) {
        printf("Resistor #%d (ohm): ", i+1);
        if (scanf("%lf", &R[i]) != 1) {
            fprintf(stderr, "Input tidak valid untuk resistor #%d.\n", i+1);
            free(R);
            return 1;
        }
        if (R[i] < 0.0) {
            fprintf(stderr, "Nilai resistor tidak boleh negatif.\n");
            free(R);
            return 1;
        }
        totalR += R[i];
    }

    printf("\nTotal resistansi (seri) = %.6g ohm\n", totalR);

    /* Tanyakan apakah user ingin menghitung arus jika ada tegangan sumber */
    printf("Apakah Anda ingin menghitung arus jika ada tegangan sumber? (y/n): ");
    char choice;
    /* consume leftover newline */
    while (getchar() != '\n'); /* bersihkan buffer sampai newline */
    choice = getchar();
    if (choice == 'y' || choice == 'Y') {
        printf("Masukkan tegangan sumber (volt): ");
        if (scanf("%lf", &voltage) != 1) {
            fprintf(stderr, "Input tegangan tidak valid.\n");
            free(R);
            return 1;
        }

        if (totalR == 0.0) {
            fprintf(stderr, "Total resistansi = 0 ohm, tidak dapat menghitung arus (bagi nol).\n");
            free(R);
            return 1;
        }

        double I = voltage / totalR;
        printf("\nArus total I = V / R_total = %.6g A\n", I);
        printf("Tegangan pada tiap resistor:\n");
        for (i = 0; i < n; ++i) {
            double Vi = I * R[i];
            printf("  Resistor #%d: R = %.6g ohm --> V = I * R = %.6g V\n", i+1, R[i], Vi);
        }
    } else {
        printf("Selesai. (tidak menghitung arus)\n");
    }

    free(R);
    return 0;
}
